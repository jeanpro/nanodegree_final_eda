---
output:
  html_document: default
  pdf_document: default
---
The Wine Geek Analysis 
========================================================
##### by Jean Phelippe Ramos de Oliveira (jean.phelippe92@gmail.com)

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using in your analysis in this code
# chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk. This
# prevents the code from displaying in the knitted HTML output. You should set
# echo=FALSE for all code chunks in your file, unless it makes sense for your
# report to show the code that generated a particular plot.

# The other parameters for "message" and "warning" should also be set to FALSE
# for other code chunks once you have verified that each plot comes out as you
# want it to. This will clean up the flow of your report.

library(lubridate)
library(ggplot2)
library(dplyr)
#install.packages("psych")
library(psych)
```

```{r echo=FALSE, Load_the_Data}
# Load the Data
data <- read.csv('wineQualityReds.csv', sep=',')
```


# Abstract
>  We know that taste is very difficult to map and understand as different people have different preferences. However, at the same time, it's well known that wines can have different levels of quality that yield a whole span of different prices. The goal of this document is to present a technical analysis over physical and chemical variables from Portuguese wines and try to shed some light on the relationships between physicochemical properties of wine and the rates given to the wines by wine experts. 

*We have deleted the variable listing the IDs.*

```{r echo=FALSE}
data <- subset(data, select = -c(X))
```


# Univariate Plots Section

Below we can find a summary statistics of all variables:

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(data)
```

 In our case, there is only one categorical variable which is quality (integers between 0 and 10).

```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = quality, data = data)
```

Let's start by analyzing the quality:

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots2}
summary(data$quality)
```

As we can see, the median is around the rating 6.0 with the best wine rated at 8.0. Which means that's very difficult to find good wines (>7) in this dataset as per statistical analysis. The plot shows that majority of wines are rates between 5 or 6. This also means that our analysis may be biased towards lower quality wines.


```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = alcohol, data = data)
```


```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(data$alcohol)
```


The minimum alcohol percentage by volume is 8.4 and it ranges up to 14.90. The dataset is skewed towards the range of 10%, which is reasonable for most wines I know. I wonder if alcohol levels are actually relevant for a good rating as stronger wines may be more difficult to appreciate. Also it is a substance that evaporates easily and can affect smell.




```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = free.sulfur.dioxide, data = data)
```


```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(data$free.sulfur.dioxide)
```


Free SO2 is also spread across a wide range. The minimum is 1 and maxiumum goes to 72 mg/dm^3. There is a higher concentration in the range of 7-20 mg/dm^3. This substance is related to oxidation of the wine and it's well known that the oxidation affects the wine taste.

```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = total.sulfur.dioxide, data = data)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(data$total.sulfur.dioxide)
```

Total SO2 has a wide range of values with the Maximum at 289mg/dm³. Minimum at 6mg/dm³ and mean around 46mg/dm³ (highr than free SO2 as expected once free SO2 should be a part of the total)

```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = total.sulfur.dioxide, data = data)+
  scale_x_log10()
```

After applying a log10 transformation to the plot we can now reduce the effect of the long tail and clearly see a more normal distribution around the value of 30g/dm³

```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = fixed.acidity, data = data)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = volatile.acidity, data = data)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = citric.acid, data = data)
```

Fixed and Volatile acidity show up with two peaks around 7-8g/dm³ for fixed and 0.4-0.6g/dm³. Fixed acidity ranges from 4.6 up to almost 16g/dm³ but the mean is around 8g/dm³. The Volatile acidity ranges from 0.12-1.58g/dm³ with Mean around 0.52g/dm³. Higher levels of volatile acidity (usually linked with acetic acid) can yield a bad taste (vinegar-like taste). The amount of non-volatile acid is way higher, because they compose the bulk of acidity on a wine.

Citric acid levels can be found at higher range than acetic acid, but they are still small compared to non-volatile. It ranges from 0-1g/dm³. 




```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = pH, data = data)
```

pH levels range from 2.74 to 4.01 which are within the acid range exactly as we expect from wines.

```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = chlorides, data = data)
```

Chlorides usually are liked to the salty taste and should be found on small quantities. They range from 0.012 up to 0.611 with median around 0.08g/dm³. It can vary up to 50 time from the minimum up to maximum values on this dataset.

```{r echo=FALSE,message=FALSE, warning=FALSE}
qplot(x = chlorides, data = data) +
  scale_x_continuous(limits = c(0.01,0.4)) +
  facet_wrap(~quality, ncol = 3)
```

Higher quality wines seem to have a more concentrated range of chlorides <0.1 but we still need to dive deeper into the data to check if there's any relationship between variables.





# Univariate Analysis

### What is the structure of your dataset?

```{r echo=FALSE}
names(data)
```
**Variables**:

1. fixed acidity (tartaric acid - g / dm^3)
2. volatile acidity (acetic acid - g / dm^3)
3. citric acid (g / dm^3)
4. residual sugar (g / dm^3)
5. chlorides (sodium chloride - g / dm^3
6. free sulfur dioxide (mg / dm^3)
7. total sulfur dioxide (mg / dm^3)
8. density (g / cm^3)
9. pH
10. sulphates (potassium sulphate - g / dm3)
11. alcohol (% by volume)
12. quality (score between 0 and 10)
   

According to the list above, we have 12 variables in which the first 11 are physicochemical properties that were measured and a final variable called quality that was a rate from 0 (very bad) to 10 (excellent) given by at least 3 wine experts. There are 1599 observations in this dataset. Most of the wines are in average quality (5-6 quality rates). 

### What is/are the main feature(s) of interest in your dataset?

The main feature that is common to our knowldege and of many people that appreciate drinks is the `alcohol level`. We'd like to evaluate the correlation between alcohol levels and quality and use other variable to understand the dynamic of the quality as we believe that there's a limit in which the alcohol level can affect taste positively.

### What other features in the dataset do you think will help support your \
investigation into your feature(s) of interest?

It's a geeky analysis as there can be way more other variables that can affect the tast of wine such as temperature and how long the wine was in contact with oxygen. However, for this analysis we really want to focus on physicochecmical properties. We think that looking at common properties that we analyze in a wine such as alcohol percentage, acidity levels (including pH), total sulfur dioxide (related to oxidation) and residual sugar (related to sweetness) may be the most impactful ones.

### Did you create any new variables from existing variables in the dataset?

```{r echo=FALSE,message=FALSE, warning=FALSE}
data$level.free.sulfur.dioxide <- cut(data$free.sulfur.dioxide, breaks=c(0, 50, 100), labels=c("Low Free SO2", "High Free SO2"))
```

Based on the description of the dataset, turns out that wines with levels of free SO2 higher than 50ppm (or mg/dm³) may have their taste affected. The SO2 mainly helps prevent oxidation, but can affect the taste if in high contration. Thus, we've created a categorical variable called `level.free.sulfur.dioxide` that splits the dataset into High(>50ppm) and Low (<=50ppm) levels of free SO2.

### Of the features you investigated, were there any unusual distributions? \
Did you perform any operations on the data to tidy, adjust, or change the form \
of the data? If so, why did you do this?

Fixed and volatile acidity have shown 2 peaks each. Whereas Total SO2 has shown a long tail shape. We applied the log10 transform to total SO2 in order to reduce the skewness from the long tail and try to visualize it a more normal shape.

# Bivariate Plots Section

> **Tip**: Based on what you saw in the univariate plots, what relationships
between variables might be interesting to look at in this section? Don't limit
yourself to relationships between a main output feature and one of the
supporting variables. Try to look at relationships between supporting variables
as well.

```{r echo=FALSE}
cor(data %>% select(1:12), method = "pearson", use = "complete.obs")
```

```{r fig2, fig.height = 15, fig.width = 15, fig.align = "center"}

pairs.panels(data, scale=TRUE)

```


After checking the correlation between all variables in the dataset we could see some high correlation between certain variabels:


*  fixed.acidity vs. density

*  fixed.acidity vs. citric.acid

*  fixed.acidity vs. pH

*  free.sulfur.dioxide vs. total.sulfur.dioxide

*  alcohol vs. density

*  quality vs. alcohol



```{r echo=FALSE, Bivariate_Plots}

# We created a function for plotting with ggplot (adapted from: https://ggplot2.tidyverse.org/)
ggplot_f <- function(dataset, x, y, opts=NULL) {
  ggplot(dataset, aes_string(x = x, y = y)) +
   geom_point(alpha = 1/5, position = position_jitter(h = 0), size = 2) +
   geom_smooth(method = 'lm')
}

# density vs. fixed.acidity plot
p <- ggplot_f(data, "density", "fixed.acidity")
p + coord_cartesian(xlim=c(min(data$density),1.005))


```

We can see the high positive correlation between fixed acidity and density. However a bit scattered in the central part.

```{r echo=FALSE}

# fixed.acidity vs. citric.acid plot
p <- ggplot_f(data, "fixed.acidity", "citric.acid")
p + coord_cartesian(xlim=c(min(data$fixed.acidity),max(data$fixed.acidity)))
```

We can see some correlation between citric acid and fixed acidity. Not as strong as others but still there.


```{r echo=FALSE}

# fixed.acidity vs. ph plot
p <- ggplot_f(data, "fixed.acidity", "pH")
p + coord_cartesian(xlim=c(min(data$fixed.acidity),max(data$fixed.acidity)))
```

A clear correlation between fixed acidity and pH. Higher fixed acidity yields lower pH, which is the definition of that index. 


```{r echo=FALSE}

# free.sulfur.dioxide vs. total.sulfur.dioxide plot
p <- ggplot_f(data, "free.sulfur.dioxide", "total.sulfur.dioxide")
p + coord_cartesian(xlim=c(min(data$free.sulfur.dioxide),max(data$free.sulfur.dioxide)))
```

Total and free sulfur dioxide also present some positive correlation as free sulfur dioxide levels depends on the molecular levels of sulfur dioxide.

```{r echo=FALSE, message = FALSE, warning = FALSE}
qplot(x = free.sulfur.dioxide, data = data, color = level.free.sulfur.dioxide)+
  geom_vline(xintercept = quantile(data$free.sulfur.dioxide, 0.99))
  
```

As we can see from above, the definition of High vs Low Free SO2 correlates with the 99th percentile of free sulfur dioxide. In other words, the cases with High Free SO2 are outliers and don't represent the dataset. Therefore, we have pretty much all wines under the 50ppm defined as ok amount of Free SO2 by the description of the dataset. From now on we won't use the variable created as it doesn't bring much value.


```{r echo=FALSE}

# alcohol vs. density plot
p <- ggplot_f(data, "alcohol", "density")
p + coord_cartesian(xlim=c(min(data$alcohol),max(data$alcohol)))
```


```{r echo=FALSE}

# alcohol vs. quality
ggplot(data, aes(x = factor(quality), y = alcohol)) +
        geom_boxplot()
```


```{r echo=FALSE}

# alcohol vs. quality
ggplot(data, aes(x = factor(quality), y = volatile.acidity)) +
        geom_boxplot()
```



# Bivariate Analysis

> **Tip**: As before, summarize what you found in your bivariate explorations
here. Use the questions below to guide your discussion.

### Talk about some of the relationships you observed in this part of the \
investigation. How did the feature(s) of interest vary with other features in \
the dataset?

* Higher alcohol levels are correlated to higher quality. 

* Volatile acidity is correlated (negatively) with quality. From the plots above we can clearly see that higher quality wines have lower volatile acidity in a more controlled range.

### Did you observe any interesting relationships between the other features \
(not the main feature(s) of interest)?

* Fixed acidity and density seems to have a strong positive correlation.

* Fixed acidity and Citric acid levels seem to have also very positive correlation. It's expected as fixed acidity is related to the acids in the wine.

* Fixed acidity levels and pH have a strong correlation as well but negative, which is more than expected as higher acidity levels are linked to lower pH level by definition.

* Total SO2 and Free SO2 also seems to have positive correlation and it's expected as more SO2 will eventually lead to more free SO2 on chemical mixtures. The degree will depend on the oxidation levels of the mixture, but it seems that for wines it's pretty much correlated.

* Interestingly enough, density and alcohol also are highly correlated (negatively). Higher levels of alcohol yields lower density wines. It's very scattered so the correlation is not strong as previous ones. But still very correlated (-0.5).

### What was the strongest relationship you found?

The strongest relationship found is between fixed acidity and pH, which is expected as pH is function of the acidity levels of a substance. Also we have strong correlation between total sulfur dioxide and free sulfur dioxide levels, which also makes sense as both depends on the levels of sulfur dioxide in the substance at a molecular levels.

# Multivariate Plots Section

> **Tip**: Now it's time to put everything together. Based on what you found in
the bivariate plots section, create a few multivariate plots to investigate
more complex interactions between variables. Make sure that the plots that you
create here are justified by the plots you explored in the previous section. If
you plan on creating any mathematical models, this is the section where you
will do that.

```{r echo=FALSE, message=FALSE, warning=FALSE, Multivariate_Plots, fig.height = 12, fig.width = 10, fig.align = "center"}

# fixed acidity vs volatile acidity vs quality
# looking at the top 95th percentile in order to skip outliers
ggplot(aes(x = fixed.acidity, y = volatile.acidity, color = factor(quality)), data = data) +
    geom_point(aes(size = factor(quality)), alpha = 1/2) +
    scale_color_identity(guide = 'legend') +
    ylim(min(data$volatile.acidity), quantile(data$volatile.acidity, 0.95)) +
    xlim(min(data$fixed.acidity), quantile(data$fixed.acidity, 0.95)) 

```


Higher quality wines tend to stay on the lower right part of the plot, which means higher fixed acidity and lower volatile acidity.

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height = 12, fig.width = 10, fig.align = "center"}
# fixed acidity vs alcohol vs quality
# looking at the top 95th percentile in order to skip outliers
ggplot(aes(x = fixed.acidity, y = alcohol, color = factor(quality)), data = data) +
    geom_point(aes(size = factor(quality)), alpha = 1/2) +
    scale_color_identity(guide = 'legend') +
    ylim(min(data$alcohol), quantile(data$alcohol, 0.95)) +
    xlim(min(data$fixed.acidity), quantile(data$fixed.acidity, 0.95)) 

```

Higher levels of alcohol and fixed acity correlates with higher quality wines, we can see the wines >=7 in terms of quality stays on the top half of the plot.


```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height = 12, fig.width = 10, fig.align = "center"}

# total sulfur dioxide vs free sulfur dioxide vs quality
# looking at the top 95th percentile in order to skip outliers
ggplot(aes(x = total.sulfur.dioxide, y = free.sulfur.dioxide, color = factor(quality)), data = data) +
    geom_point(aes(size = factor(quality)), alpha = 1/2) +
    scale_color_identity(guide = 'legend') +
    ylim(min(data$free.sulfur.dioxide), quantile(data$free.sulfur.dioxide, 0.95)) +
    xlim(min(data$total.sulfur.dioxide), quantile(data$total.sulfur.dioxide, 0.95)) 
```

Good wines concentrate on the left side of the plot, we can see some correlation between higher quality wines and lower levels of total sulfur dioxide, in terms of free sulfur dioxide it's not that clear but they tend to stay in a region of lower concentration. 





# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the \
investigation. Were there features that strengthened each other in terms of \
looking at your feature(s) of interest?

If we look at volatile acidity vs fixed acidity vs quality we can see there is a "sweet spot" area on the bottom right corner where lies the top quality wines (quality = 8) surronded by wines quality 5, 6 and 7. It's not 100% correlated but we can see a higher density of 7's and 8's down there compared to the opposite corner with higher volatile acidity and lower fixed acidity. 

Also, if we look at the alcohol vs fixed acidity vs quality we can see that there is also another area with higher concentration of top quality wines (specially if we focus on 7's [yellow dots] and 8's [black dots]) on the top right corner with higher alcohol percentage and higher fixed acidity. Which aligns with our analysis from previous sections. It seems that alcohol levels and fixed acidity contributes for a higher quality wine perception. If we do the inverse excercise and look at the *bottom part of the chart* we can see almost no wines above 6 in terms of quality. 

Finally, when looking at free sulfur dioxide vs total sulfur dioxide vs quality we can see majority of wines concentrate in a range of <25 for free sulfur dioxide but without much correlation with quality, which makes sense as the property is just related to conserving the wine. On the other hand, we can see higher quality wines staying at lower levels of total sulfur dioxide. It's known that too high levels of sulfur dioxide may alter the taste of wine.

### Were there any interesting or surprising interactions between features?

It seems there's a cluster towards lower levels of free sulfur dioxide and total sulfur dioxide. It makes sense as sulfur dioxide is used mainly for conservation purposes. Therefore, it should have a standard concentration amongst wines with a delimited range. More than a certain concentration would only ruin the wine, lower would make it too perishable.


### OPTIONAL: Did you create any models with your dataset? Discuss the \
strengths and limitations of your model.

------

# Final Plots and Summary

> **Tip**: You've done a lot of exploration and have built up an understanding
of the structure of and relationships between the variables in your dataset.
Here, you will select three plots from all of your previous exploration to
present here as a summary of some of your most interesting findings. Make sure
that you have refined your selected plots for good titling, axis labels (with
units), and good aesthetic choices (e.g. color, transparency). After each plot,
make sure you justify why you chose each plot by describing what it shows.

### Plot One
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align = "center", Plot_One}



ggplot(data, aes_string(x = "density", y = "fixed.acidity")) +
   geom_point(alpha = 1/5, position = position_jitter(h = 0), size = 2) +
   geom_smooth(method = 'lm') + 
   coord_cartesian(xlim=c(min(data$density),1.005)) +
   xlab('Density (g/cm^3)') +
   ylab('Fixed Acidity (g/dm^3)') +
   ggtitle('Density vs. Fixed Acidity (Tartic Acid) correlation') + 
   theme(plot.title = element_text(hjust = 0.5))

```

### Description One

From all the properties analyzed, Alcohol levels and density have the strongest correlation (approximately 0.67). The `Plot One` demonstrates the correlation and has a linear model that shows the trend and error based on `geom_smooth` function from the library `ggplot2` as a representation of the correlation. 

### Plot Two
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height = 10, fig.width = 10, fig.align = "center", Plot_Two}

data$quality = as.factor(data$quality)

ggplot(aes(x = fixed.acidity, y = volatile.acidity, color = quality), data = data) +
    geom_point(aes(size = quality), alpha = 1/3) +
    scale_color_identity(guide = 'legend') +
    ylim(min(data$volatile.acidity), quantile(data$volatile.acidity, 0.95)) +
    xlim(min(data$fixed.acidity), quantile(data$fixed.acidity, 0.95)) +
    xlab('Fixed Acidity (g/dm^3)') +
    ylab('Volatile Acidity (g/dm^3)') +
    ggtitle('Wine Quality correlation with Fixed (Tartic Acid) and Volatile (Acetic Acid) acidity levels') +
   theme(plot.title = element_text(hjust = 0.5))

```

### Description Two

`Plot Two` shows us the correlation between higher quality wines, lower levels of volatile acidity and higher levels of fixed acidity. In other words, the higher quality wines concentrate at the bottom right corner of the plot. 


### Plot Three
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align = "center", Plot_Three}

ggplot(data = data, aes(y = alcohol, x = factor(quality))) +
   geom_boxplot() +
   xlab('Quality') +
   ylab('Alcohol (% by vol)') +
   ggtitle('How Alcohol Level Affects Wine Quality') +
   theme(plot.title = element_text(hjust = 0.5))

```

### Description Three

The variable with strongest correlation to quality was alcohol levels. From the `Plot Three` we can see that higher quality wines (quality levels around 7 and 8) have higher alcohol % over volume. It seems that this variable has a strong relavance on defining the wine quality.
------

# Reflection

> **Tip**: Here's the final step! Reflect on the exploration you performed and
the insights you found. What were some of the struggles that you went through?
What went well? What was surprising? Make sure you include an insight into
future work that could be done with the dataset.

We have performed an Exploratory Data Analysis over the dataset related to red variant of the Portuguese "Vinho Verde" wine. We tried to first understand the dataset and it's variables, look for validations, for instance the low pH levels as expected from wines due to acidity. Similarly, we looked into trends and how the quality of the wines was distributed. Aftewards, we started to look for correlations and trends between different variables. Finally, we looked at those same trends and their correlation with quality, the main variable of interest in this dataset. Below we can find few highlights over this process.

* It seems there's only a variable with stronger corrlation with quality which is `alcohol` levels. We were able to see that higher quality wines (quality levels around 7 and 8) have higher alcohol percentages. Maybe stronger wines use more grapes or higher quality grapes that have more sugar yileding better wines. Or maybe the taste of the wine as an alcohol drink is also linked to the taste of alcohol. Abscence of alcohol may also affect the smells as it is a very volatile substance.

* `Volatile acidity` and `Fixed acidity` also have some correlation with the quality. We could interpret it as more "stable" wines with higher levels of fixed acidity and lower levels of volatile acidity tend to have better quality. The volatile acidity is linked to acetic acid that can potentially bring some bad taste (like vinegar). Hence, higher levels of volatile acidity would definetely impact the taste and quality negatively. On the other hand, fixed acidity is linked to the pH which measuares how basic or acid a substance is and by definition can affect the taste as our mouth reacts differently for different levels of pH. We don't have enough data to show that the variation on the dataset would actually be percieved by a human paladar.

* Overall we had a lot of variables to look at, we ended up focusing on a few that sounded as they would impact taste. Of course, we could expand this analysis endelessly, but given the time and knowledge constraint we chose a few variables and we didnt perform any relevant transformations. Segragating the dataset between higher and lower levels of sulfur dioxide showed no results whatsoever. 


For a next step, we would like to look into prices, costs and brands and how they would affect the quality evaluations. Also, trying to understand better the evalutaion process given the weather and temperature as it definely affects the sensorial experiences.


> Citation: P. Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis. 
  Modeling wine preferences by data mining from physicochemical properties.
  In Decision Support Systems, Elsevier, 47(4):547-553. ISSN: 0167-9236.

